<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandatory I</title>
    
    <!-- Bootstrap Stylesheet -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    
</head>
<body class="d-flex flex-column" style="min-height: 100vh; background-color: eeeeee;">

    <nav class="navbar navbar-expand-lg navbar-dark sticky-top shadow-lg p-3" 
         style="background: rgba(64, 57, 74, 0.88);">
        <div class="container-fluid">
            <a class="navbar-brand fw-light fst-italic" href="/home">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-bookmark-star" viewBox="0 0 16 16">
                    <path d="M7.84 4.1a.178.178 0 0 1 .32 0l.634 1.285a.178.178 0 0 0 .134.098l1.42.206c.145.021.204.2.098.303L9.42 6.993a.178.178 0 0 0-.051.158l.242 1.414a.178.178 0 0 1-.258.187l-1.27-.668a.178.178 0 0 0-.165 0l-1.27.668a.178.178 0 0 1-.257-.187l.242-1.414a.178.178 0 0 0-.05-.158l-1.03-1.001a.178.178 0 0 1 .098-.303l1.42-.206a.178.178 0 0 0 .134-.098L7.84 4.1z"/>
                    <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/>
                </svg>
              My Node JS Documentation
            </a>
        </div>
        <div class="container-fluid justify-content-end">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/home">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/javascript">Javascript</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/npm">NPM</a>   
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/express">Express</a>
                </li>
            </ul>
        </div>
    </nav>

    <main class="container-fluid mt-3">
        <article class="container border border-2">
            <div class="mt-2">
                <p class="fs-2 text fst-italic fw-bolder">Express</p> <hr>
                <div>
                    <p class="fs-3 fw-light">What is <i>Express</i> ?</p>
                    <b>Express</b> is a <b>Node JS</b> framework that provides a lot 
                    of utilities for quickly and easily creating APIs.

                    <p class="fs-3 fw-light"> <br> How to use <i>Express</i> ?</p>
                    Provided the <b>Express</b> dependency is already installed, all we
                    need to do now is to write: <kbd>require( "express" );</kbd> in order to
                    import it. It is also good to store it in a variable, for later use. <br>
                    Example:
                    <pre class="border rounded"> 
                        <code>
                            const express = require( "express" );
                        </code>
                    </pre>
                    
                    Now we can call <code>express</code> to launch the application, like so: 
                    <kbd>express();</kbd>. This can also be stored in a variable: 
                    <pre class="border rounded"> 
                        <code>
                            const express = require( "express" );
                            const app = express();
                        </code>
                    </pre>

                    The next thing we want to do is to tell the <code>app</code> to listen
                    on a port. We do that by using the <code>listen()</code> function.
                    <pre class="border rounded"> 
                        <code>
                            app.listen( 3000 );
                        </code>
                    </pre>
                    If we now try to go to <code>localhost:3000</code>, we will be greeted with
                    the following message: <code class="font-monospace">Cannot GET /</code>. That means
                    there is no <span class="badge bg-primary">GET</span> mapping implemented for
                    <code>localhost:3000/</code>. <br> <br>

                    Now that the <code>application</code> is up and running, we can start implementing
                    the API. <br>
                     We will do so by following this documentation:
                    <div class="container-fluid">
                        <div class="container border border-primary rounded py-1 my-1">
                            <span class="badge bg-primary">GET</span>
                            /plants - Retrieves the list of plants
                        </div>
                        
                        <div class="container border border-primary rounded py-1 my-1">
                            <span class="badge bg-primary">GET</span>
                            /plants/id - Retrieves the plant with the provided id
                        </div>

                        <div class="container border border-success rounded py-1 my-1">
                            <span class="badge bg-success">POST</span>
                            /plants - Creates a new plant entry
                        </div>

                        <div class="container border border-warning rounded py-1 my-1">
                            <span class="badge bg-warning">PATCH</span>
                            /plants/id - Updates a plant with the given id
                        </div>

                        <div class="container border border-danger rounded py-1 my-1">
                            <span class="badge bg-danger">DELETE</span>
                            /plants/id - Deletes a plant entry with the given id
                        </div>
                    </div>
                    <p class="fs-4 fw-light"> <br> <span class="badge bg-primary">GET</span> /plants </p>

                    <b>Express</b> provides a set of handy functions in order to map 
                    HTTP request methods. For implementing our first <span class="badge bg-primary">GET</span> 
                    mapping, we will make use of the <kbd>app.get()</kbd> function, like so:
                    <pre class="border rounded"> 
                        <code>
                            // The first argument that we pass is the path we want to make the mapping for
                            // The second argument is a callback function in which we are sending the plants.
                            app.get( "/plants", ( req, res ) => {
                                res.send( plants );
                            } );
                        </code>
                    </pre>
                    Before we can actually use this code, we should define what <code>plants</code> is. While
                    it could be used as an variable filled with data from a database, we are going to make an
                    <code>array</code> in which we will hard-code some simple plant objects for the purposes 
                    of testing our code.
                    <pre class="border rounded"> 
                        <code>
                            let plants = [
                                {
                                    "id": 1,
                                    "name": "Cephalotus follicularis"
                                },
                                {
                                    "id": 2,
                                    "name": "Sarracenia purpurea"
                                }
                            ];
                        </code>
                    </pre>
                    If we are now accessing <code>localhost:3000/plants</code>, we will get the following
                    output: <code>[{"id":1,"name":"Cephalotus follicularis"},{"id":2,"name":"Sarracenia purpurea"}]</code> <br> <br>

                    <p class="fs-4 fw-light"> <br> <span class="badge bg-primary">GET</span> /plants/id </p>
                    Implementing the next mapping will be a little bit more difficult, as we have to make use
                    of <code>path variables</code> in order to extract the id of the plant we want to retrieve
                    from the URL. <br>
                    <pre class="border rounded"> 
                        <code>
                            // We mark a part of a path as a path variable by adding ':' before it
                            // We can then take these variables in req.params
                            app.get( "/plants/:id", ( req, res ) => {
                                // Retrieving the id from the URL
                                const id = parseInt( req.params.id );
                                
                                // Looking for the plant with the given id
                                const foundPlant = plants.find( ( plant ) => {
                                    return plant.id === id;
                                } );
                            
                                // If no plant has been found, we send a message saying that
                                const response = foundPlant ? foundPlant : {
                                    exception: "No carnivorous plant with the given id was found"
                                };
                            
                                res.send( response );
                            } );
                        </code>
                    </pre>

                    <p class="fs-4 fw-light"> <br> <span class="badge bg-success">POST</span> /plants </p>
                    Because we are implementing a <b>REST API</b>, the information that we are working with
                    is transferred the <b>JSON</b> format. In the previous examples, we only sent data; now
                    we will receive <b>JSON</b> data that we now need to parse, however, <b>Javascript</b> doesn't
                    know how to do that by default. Thankfully, <b>Express</b> comes with a <b>JSON</b> parser
                    that we can use. We can achieve it like this: <kbd>app.use( express.json() ); </kbd> <br> <br>

                    Now we should be ready to implement the <span class="badge bg-success">POST</span>
                    mapping which will take care of getting the <b>JSON</b> data that it receives and
                    adding it as a new element in our <code>plants</code> array.
                    <pre class="border rounded"> 
                        <code>
                            let ID = plants.length;
                            app.post( "/plants", ( req, res ) => {
                                // We are creating a new plant from the data received in req.body
                                const newPlant = req.body;

                                // Regardless of what id this plant had ( if it had any )
                                // we are overwriting it just as a database would with the
                                // auto-increment constraint
                                newPlant.id = ++ID;

                                plants.push( newPlant );

                                // We are now sending back the plant that actually got saved in the array
                                res.send( newPlant );
                            } );
                        </code>
                    </pre>
                    
                    <p class="fs-4 fw-light"> <br> <span class="badge bg-warning">PATCH</span> /plants/id </p>
                    The purpose of the <span class="badge bg-warning">PATCH</span> mapping is to
                    be able to alter the data of an entry with the id we provide. <br>
                    This would be one way of implementing it:
                    <pre class="border rounded"> 
                        <code>
                            app.patch( "/plants/:id", ( req, res ) => {
                                const id = parseInt( req.params.id );
                                let hasUpdated = false
                            
                                plants = plants.map( plant => { 
                                    if ( plant.id === id ) {
                                        hasUpdated = true;

                                        // Once we find the plant, we are returning
                                        // its original content, overwriting it with 
                                        // the body that we receive, while making sure
                                        // the id stays the same
                                        return { ...plant, ...req.body, id: plant.id };
                                    }
                                    return plant;
                                } );
                            
                                res.send( { hasUpdated: hasUpdated } );
                            } );
                        </code>
                    </pre>

                    <p class="fs-4 fw-light"> <br> <span class="badge bg-danger">DELETE</span> /plants/id </p>
                    This <span class="badge bg-danger">DELETE</span> mapping is meant to remove an entry at
                    the id we provide it.
                    <pre class="border rounded"> 
                        <code>
                            app.delete( "/plants/:id", ( req, res ) => {
                                // Getting the id
                                const id = parseInt( req.params.id );
                            
                                // Removing the plant by filtering it out based on the id
                                plants = plants.filter( plant => plant.id !== id );
                            
                                res.send( { } );
                            } );
                        </code>
                    </pre>

                    <hr> <p class="fs-3 fw-light">Extras</p>

                    We can add some error checking in our <code>app.listen()</code> function
                    by providing it a callback function, similar to this: 
                    <pre class="border rounded"> 
                        <code>
                            app.listen( 3000, ( error ) => {
                                // We print the error, if there is any
                                if ( error ) {
                                    console.log( error );
                                }

                                // We display the port we are running the server on, in case of no errors
                                console.log( "Server running on port: ", 3000 );
                            } );
                        </code>
                    </pre>

                    <p class="fs-3 fw-light">Serving files with <i>Express</i> </p>

                    We can serve <b>HTML</b> files in <b>Express</b> by using <kbd>res.sendFile()</kbd>
                    function. In order to provide this function the path to the file we want to serve,
                    independent of the OS or the folder we are running the app from, we can use <code>__dirname</code>,
                    like so: 
                    <pre class="border rounded"> 
                        <code>
                            app.get( "/", ( req, res ) => {
                                res.sendFile( __dirname + "/public/index.html" );
                            } );
                        </code>
                    </pre>

                    There may be instances where the <b>HTML</b> file we are trying to serve is referring to a
                    <code>stylesheet</code> or a <code>javascript</code> file.
                    <pre class="border rounded"> 
                        <code>
                            &lt;link rel="stylesheet" href="style.css"&gt;
                            &lt;script src="./script.js"&gt;&lt;/script&gt;
                        </code>
                    </pre>
                    In this case, we may want to tell <b>Express</b> to statically serve the files from our
                    public folder as they are requested:
                    <pre class="border rounded"> 
                        <code>
                            app.use( express.static( "public" ) );
                        </code>
                    </pre>
                </div>
            </div>
        </article>
    </main>

    <footer class="footer py-3 bg-light mt-auto">
        <div class="container-fluid">
            <!-- Link to Project's Github -->
            <a class="btn btn-outline-dark" href="https://github.com/CristiPV/kea-node-mandatory-I" role="button">
               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
              </svg>
              Project's Github
            </a>
            <span class="text-muted">Created by Cristian-Valentin Purcea</span>
        </div>
    </footer>

    <!-- Bootstrap Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
</body>
</html>